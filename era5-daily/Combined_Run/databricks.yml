bundle:
  name: era5_01_bronze_source_to_staging_run

run_as:
  service_principal_name: "0dbc3b87-0681-43d4-b52e-53bce65fcae5"

resources:
  jobs:
    # real pipeline job, default = scheduled daily at midnight
    era5_01_bronze_source_to_staging_job:
      name: era5_01_bronze_source_to_staging_job
      schedule:
        quartz_cron_expression: '0 0 0 * * ?'
        timezone_id: 'UTC'
      tags:
        BRANCH: will_be_set_by_github_action
      tasks:
        - task_key: era5_01_bronze_source_to_staging_task
          spark_python_task:
            python_file: src/era5_01_bronze_source_to_staging.py
            parameters:
              - --catalog_schema
              - era5_daily_data.bronze_dev
          existing_cluster_id: "0406-134207-et9icx79"

    # test wrapper job, default = no schedule
    test_era5_01_bronze_source_to_staging_job:
      name: test_era5_01_bronze_source_to_staging_job
      tags:
        BRANCH: will_be_set_by_github_action
      tasks:
        - task_key: test_era5_01_bronze_source_to_staging_task
          spark_python_task:
            python_file: tests/run_pytest.py
          existing_cluster_id: "0406-134207-et9icx79"

workspace_host: &workspace_host https://dbc-ad3d47af-affb.cloud.databricks.com/

targets:
  production:
    mode: production
    workspace:
      host: *workspace_host
    # No overrides: pipeline runs daily, test job never schedules itself.

  development:
    mode: development
    workspace:
      host: *workspace_host
    resources:
      jobs:
        # disable pipeline cron in dev
        era5_01_bronze_source_to_staging_job:
          schedule: null

  test:
    mode: development
    workspace:
      host: *workspace_host
    resources:
      jobs:
        # also disable pipeline cron in test
        era5_01_bronze_source_to_staging_job:
          schedule: null
