# The main job for combined_run.
resources:
  jobs:
    era5_dev_source_to_staging_job:
      name: era5_dev_source_to_staging_job
      tasks:
        - task_key: unit_tests_task
          job_cluster_key: era5_dev_source_to_staging  # job cluster key
          notebook_task:
            notebook_path: ../tests/source-to-staging-run-unit-test.py

        - task_key: run_on_sample_task
          depends_on:
            - task_key: unit_tests_task
          job_cluster_key: era5_dev_source_to_staging  # job cluster key
          notebook_task:
            notebook_path: ../src/SM_Source_to_Staging.py

        - task_key: data_quality_spatial_dimension_check_task
          depends_on:
            - task_key: run_on_sample_task  # Depends on the previous notebook
          job_cluster_key: era5_dev_source_to_staging  # job cluster key
          notebook_task:
            notebook_path: ../src/SM_Data_Quality_Spatial_Dimension_Check.py  # Path to the new notebook

      job_clusters:
        - job_cluster_key: era5_dev_source_to_staging  # job cluster key
          new_cluster:
            spark_version: 14.3.x-scala2.12 
            node_type_id: r5d.xlarge  
            aws_attributes:
              first_on_demand: 1
            autoscale:
              min_workers: 2  
              max_workers: 8  
            data_security_mode: "SINGLE_USER"  # Enforcing Single user access mode
            single_user_name: "smajumder1@ua.edu"  # username

    era5_dev_source_to_bronze_country_boundaries_job:
      name: era5_dev_source_to_bronze_country_boundaries_job
      depends_on: 
        - era5_dev_source_to_staging_job  # Depends on the previous job

      tasks:
        - task_key: unit_tests_task
          job_cluster_key: era5_dev_country_boundaries
          notebook_task:
            notebook_path: ../tests/source_to_bronze_countryboundaries_run-unit-test.py

        - task_key: run_on_sample_task
          depends_on:
            - task_key: unit_tests_task
          job_cluster_key: era5_dev_country_boundaries 
          notebook_task:
            notebook_path: ../src/01_Source_to_Bronze_Country_Boundaries.py

      job_clusters:
        - job_cluster_key: era5_dev_country_boundaries 
          new_cluster:
            spark_version: 15.1.x-scala2.12  # Keeping the original Spark version
            node_type_id: r6id.xlarge  # node type
            aws_attributes:
              first_on_demand: 1
            autoscale:
              min_workers: 2  # Minimum workers 
              max_workers: 8  # Maximum workers 
            data_security_mode: "SINGLE_USER"  # Enforcing Single user access mode
            single_user_name: "smajumder1@ua.edu"  # Username

    era5_dev_staging_to_bronze_job:
      name: era5_dev_staging_to_bronze_job
      depends_on: 
        - era5_dev_source_to_bronze_country_boundaries_job  # Depends on the previous job

      tasks:
        - task_key: unit_tests_task
          job_cluster_key: era5_dev_staging_to_bronze  # Updated job cluster key
          notebook_task:
            notebook_path: ../tests/staging-to-bronze-run-unit-test.py

        - task_key: run_on_sample_task
          depends_on:
            - task_key: unit_tests_task
          job_cluster_key: era5_dev_staging_to_bronze  # Updated job cluster key
          notebook_task:
            notebook_path: ../src/01_Staging_to_Bronze.py

        - task_key: data_value_check_task
          depends_on:
            - task_key: run_on_sample_task  # Depends on the previous notebook
          job_cluster_key: era5_dev_staging_to_bronze  # Updated job cluster key
          notebook_task:
            notebook_path: ../src/01_SM_Data_Value_Check.py  # Path to the new notebook

        - task_key: date_range_check_task
          depends_on:
            - task_key: data_value_check_task  # Depends on the data value check notebook
          job_cluster_key: era5_dev_staging_to_bronze  # Updated job cluster key
          notebook_task:
            notebook_path: ../src/01_SM_Date_Range_Check.py  # Path to the new notebook

      job_clusters:
        - job_cluster_key: era5_dev_staging_to_bronze  # Updated job cluster key
          new_cluster:
            spark_version: 14.3.x-scala2.12  # Updated Spark version
            node_type_id: r5d.xlarge  # Updated node type
            aws_attributes:
              first_on_demand: 1
            autoscale:
              min_workers: 2  # minimum workers
              max_workers: 8  # maximum workers
            data_security_mode: "SINGLE_USER"  # Enforcing Single user access mode
            single_user_name: "smajumder1@ua.edu"  # Username

    era5_bronze_to_silver_country_indices_job:
      name: era5_bronze_to_silver_country_indices_job
      depends_on: 
        - era5_dev_staging_to_bronze_job  # Depends on the previous job

      tasks:
        - task_key: unit_tests_task
          job_cluster_key: era5_dev_country_indices
          notebook_task:
            notebook_path: ../tests/bronze-to-silver-countryindices-run-unit-test.py 

        - task_key: unit_tests_task_2
          depends_on:
            - task_key: unit_tests_task
          job_cluster_key: era5_dev_country_indices  
          notebook_task:
            notebook_path: ../tests/df-tessellate-bronze-to-silver-countryindices-run-unit-test.py

        - task_key: ingest_countries
          depends_on:
            - task_key: unit_tests_task_2
          job_cluster_key: era5_dev_country_indices  
          notebook_task:
            notebook_path: ../src/01_Ingest_Countries.py 

        - task_key: validate_countries
          depends_on:
            - task_key: ingest_countries
          job_cluster_key: era5_dev_country_indices  
          notebook_task:
            notebook_path: ../src/02_Validate_Countries.py

        - task_key: tessellate_countries
          depends_on:
            - task_key: validate_countries
          job_cluster_key: era5_dev_country_indices  
          notebook_task:
            notebook_path: ../src/03_Tessellate_Countries.py 

        - task_key: viz_countries
          depends_on:
            - task_key: tessellate_countries
          job_cluster_key: era5_dev_country_indices  
          notebook_task:
            notebook_path: ../src/04_Viz_Countries.py 

        - task_key: union_chips
          depends_on:
            - task_key: viz_countries
          job_cluster_key: era5_dev_country_indices  
          notebook_task:
            notebook_path: ../src/05_Union_Chips.py

      job_clusters:
        - job_cluster_key: era5_dev_country_indices
          new_cluster:
            spark_version: 13.3.x-scala2.12  # Updated Spark version
            node_type_id: r5d.4xlarge  # node type
            aws_attributes:
              first_on_demand: 1
            runtime_engine: "PHOTON"  # Enabling Photon acceleration
            init_scripts:
              - workspace:
                  destination: "/Users/smajumder1@ua.edu/Data-Engineering/era5-daily/Combined_Run/combined_run/geospatial/mosaic/gdal/jammy/mosaic-gdal-init.sh"
            autoscale:
              min_workers: 4
              max_workers: 8 
            data_security_mode: "SINGLE_USER"  # Enforcing Single user access mode
            single_user_name: "smajumder1@ua.edu"  # Username

    era5_bronze_to_silver_approximate_join_job:
      name: era5_bronze_to_silver_approximate_join_job
      depends_on: 
        - era5_bronze_to_silver_country_indices_job  # Depends on the previous job

      tasks:
        - task_key: unit_tests_task
          job_cluster_key: era5_dev_approximate_join  # job cluster key
          notebook_task:
            notebook_path: ../tests/bronze-to-silver-approximate-join-run-unit-test.py

        - task_key: run_on_sample_task
          depends_on:
            - task_key: unit_tests_task
          job_cluster_key: era5_dev_approximate_join  # job cluster key
          notebook_task:
            notebook_path: ../src/02_HK_SM_Bronze_to_Silver_era5_country_approximate_join_autoloader.py

      job_clusters:
        - job_cluster_key: era5_dev_approximate_join  # job cluster key
          new_cluster:
            spark_version: 13.3.x-scala2.12  # Updated Spark version
            node_type_id: i3.xlarge  # node type
            aws_attributes:
              first_on_demand: 1
            runtime_engine: "PHOTON"  # Enabling Photon acceleration
            init_scripts:
              - workspace:
                  destination: "/Users/smajumder1@ua.edu/Data-Engineering/era5-daily/Combined_Run/combined_run/geospatial/mosaic/gdal/jammy/mosaic-gdal-init.sh"
            autoscale:
              min_workers: 2  # Updated minimum workers
              max_workers: 8  # Updated maximum workers
            data_security_mode: "SINGLE_USER"  # Enforcing Single user access mode
            single_user_name: "smajumder1@ua.edu"  # Username 

    era5_bronze_to_silver_strict_join_job:
      name: era5_bronze_to_silver_strict_join_job
      depends_on: 
        - era5_bronze_to_silver_approximate_join_job  # Depends on the previous job

      tasks:
        - task_key: unit_tests_task
          job_cluster_key: era5_dev_strict_join  # job cluster key
          notebook_task:
            notebook_path: ../tests/bronze-to-silver-strict-join-run-unit-test.py

        - task_key: run_on_sample_task
          depends_on:
            - task_key: unit_tests_task
          job_cluster_key: era5_dev_strict_join  # job cluster key
          notebook_task:
            notebook_path: ../src/02_HK_SM_Bronze_to_Silver_era5_country_strict_join_autoloader.py

      job_clusters:
        - job_cluster_key: era5_dev_strict_join  # job cluster key
          new_cluster:
            spark_version: 13.3.x-scala2.12  # Updated Spark version
            node_type_id: i3.xlarge  # node type
            aws_attributes:
              first_on_demand: 1
            runtime_engine: "PHOTON"  # Enabling Photon acceleration
            init_scripts:
              - workspace:
                  destination: "/Users/smajumder1@ua.edu/Data-Engineering/era5-daily/Combined_Run/combined_run/geospatial/mosaic/gdal/jammy/mosaic-gdal-init.sh"
            autoscale:
              min_workers: 2  # Updated minimum workers
              max_workers: 8  # Updated maximum workers
            data_security_mode: "SINGLE_USER"  # Enforcing Single user access mode
            single_user_name: "smajumder1@ua.edu"  # Username
